# 本文将给大家讲解什么是RIP，为什么使用它，以及它的工作原理

## 一、什么是RIP协议？
RIP协议（Routing Information Protocol，路由信息协议）是一种基于距离矢量的内部网关协议，即根据跳数来度量路由开销，进行路由选择。

相比于其它路由协议（如OSPF、ISIS等），RIP协议实现更简单，对带宽、配置和管理等要求也更低，但受到路由跳数和收敛速度的限制，跳数大于15就认为网络不可达，所以无法用在大型复杂网络中。

## 二、为什么要使用RIP？
在出现动态路由之前，静态路由有几个问题无法解决：

问题一：当网络拓扑结构和链路状态发生变化，需要对路由器的静态路由信息进行大范围修改，工作复杂度高。

问题二：网络发生故障时，不能重选路由，很可能使路由失败。

为了解决这些问题，动态路由协议就出现了，路由器自动学习，自适应网络的变化，无需人工更改配置。

## 三、RIP用在哪里？
RIP适用于中小型网络，因为RIP是基于距离矢量的算法(D-V算法)。由于其只能支持0-15跳,第十六跳会被标记成无限大或不可达。所以在整个网络中，只能有16个路由器相互成为rip邻居路由器，由于以上原因，所以RIP只能应用于中小型网络。

## 四、RIP协议的工作原理
如下图，分别有RTA、RTB、RTC三个路由器，每个路由器首先学习到己的直连路由，形成路由表。

然后我们在路由器上配置RIP协议，配置完成后路由器每隔30s就会向他的直连路由通告自己的路由表。比如RTB会将自己的路由表发给RTC，RTC会将自己表中没有的20.0.0.0网段添加进去，记住下一跳，并标记跳数为1。

在经过第一个30s的更新之后，这3个路由器的路由表如下图：

路由器的第二个更新周期到来，路由器将会再次向邻居发送路由表。RTA发送路由表给RTB，但是RTB已经不需要学习了。

不用学习的原因：RTB的路由表中包含RTA的所有网段。

RTB将自己的路由表发送给RTA，RTA会将40.0.0.0这个网段加到自己的路由表中，添加下一跳地址标志为20.0.0.2（因为是通过这个端口收到的），并添加距离标记为2。RTC也会同样更新自己的路由表。最后的路由表如下图：

## 五、总结
RIP是一种出现较早的路由协议，通过简单的距离矢量算法来计算到达目的网络的最佳路径，实现和维护起来都比较容易，能够满足早期小型网络的需求，但RIP的扩展性受到转发跳数的限制，且RIP每次进行路由更新都会占用大量带宽，链路故障后需要花费较长时间才能实现收敛，所以相比于后面出现的OSPF等路由协议，在路由收敛速度上存在明显不足，无法用在一些现代的大型复杂网络中。

# nat
## NAT产生背景
1. 为了节省IP地址和费用，一般企业内部都是使用私有IP地址
2. Internet网路的组成设备，使用的都是公有IP地址
3. 企业内网要与internet互通，必须拥有公有IP地址
4. 企业内网中的设备，无法使用私有地址与internet互通


 

分析：

1. 在企业网络的边缘设备（路由器）上，配置默认路由，企业内网可以将数据发送到Internet
2. 由于Internet设备上没有私有IP地址的路由条目，所以数据无法返回到企业内网
3. 在企业网络的边缘设备（路由器）上，使用NAT技术，实现私有地址和公有地址互相转换
## NAT概述
NAT（Network Address Translation），网络地址转换

1. 主要应用在企业网络的边缘设备上
2. 对数据包的私有IP地址和公有IP地址进行转换，实现内网到外网的访问
3. 实现企业内网的保护，增强企业内网的安全性。因为外网无法直接访问内部设备的私有IP地址
## NAT工作原理
路由器对数据包进行地址转换，路由器在接收到内部数据包时将内部源IP地址转化为公有IP地址后在进行路由转发。

**NAT核心工作表：NAT转换表**



## NAT类型
**静态NAT**

1. NAT表条目是通过手动配置的方式添加进去的
2. 私有IP地址和公有IP地址是 1对1 的关系，不节省公网IP地址
**动态NAT**

1. NAT表中的条目是 路由器出炉数据包 时自动形成的
2. 基于NAT地址池 实现私有地址和公有地址之间的转换，比静态NAT更加节省公网IP
## 静态NAT配置

如图配置拓扑图，当企业内网想访问外部网络的服务时，在边界路由器上配置默认路由可以将数据包发送出去，但是由于公网的路由器上没有到私网的路由，故造成数据包有去无回导致无法通行

**静态NAT配置**

[AR1]ip route-static 0.0.0.0 0 100.1.1.2   配置默认路由去往公网
[AR1]interface gi0/0/1
[AR1-GigabitEthernet0/0/1]nat static global 100.1.1.3 inside 192.168.10.1
[AR1-GigabitEthernet0/0/1]quit 


静态NAT可以实现内网的PC1与外网的设备的互通，但是内网的其它设备无法与外网的设备互通

静态NAT存在的弊端：

1. 静态NAT中私有地址和公有地址是1:1的关系，并不节省公网IP地址
2. 内网主机非常多的时候，不节省配置，并且浪费钱

在企业内网主机比较多的时候，不采用静态NAT，而是采用动态NAT

## 动态NAT
公司内部私有地址主机数量非常多的时候，如果才有静态NAT为每个私有IP地址，就会浪费公网IP地址

在动态NAT中，企业可以同时购买多个公网IP地址，然后将这些公网IP地址，轮着给企业内网的每个主机使用



第一步：撤销静态nat的配置

[AR1-GigabitEthernet0/0/1]undo nat static global 100.1.1.3 inside 192.168.10.1 n
etmask 255.255.255.255  

1. 创建ACL，匹配内网需要上网的私有主机地址

[AR1]acl 2000
[AR1-acl-basic-2000]rule 10 permit source 192.168.10.0 0.0.0.255
[AR1-acl-basic-2000]quit

1. 创建NAT地址池，专门用于地址转换的公网地址，

[R1]nat address-group 1 100.1.1.50  100.1.1.60
1. 在边界设备的公网端口，配置动态NAT命名
2. 通过NAT命令，将匹配稀有地址的ACL和用于地址转换的公网地址结合起来
3. 在g0/0/1端口发送数据流量时
    1. 对源头地址属于192.168.10.0/24的数据包（ACL 2000）进行地址转换（NAT）转换成地址池1中的公网IP地址
    
[AR1]interface gi0/0/1
[AR1-GigabitEthernet0/0/1]nat outbound  2000  address-group  1 no-pat

此时PC1/PC2都能与外网互通

缺点：

1. 进行测试的时候，我们发现：网络是一会通，一会不通。
2. 经过上面测试、抓包，我们发现：动态NAT对端口上发送出去的每个数据包的源IP地址
3. 数据包的数量太大了，所以用于地址转换的公网地址，数量肯定是不够的。
4. 在动态NAT技术突出的主要矛盾就是：用来进行地址转换的公网地址太少了。